# API测试使用说明

本文档说明如何使用test目录下的脚本测试文档处理服务。

## 目录结构

```
test/
├── test_api.py                 # 基础API测试
├── test_api_example.py         # API使用示例
├── test_api_stress.py          # API压力测试
├── test_real_data_api.py       # 使用实际数据的API测试
├── run_real_data_test.sh       # 运行实际数据测试的bash脚本
└── README.md                   # 本说明文件
```

## 使用实际数据测试

### 1. 启动服务

在运行测试之前，请确保文档处理服务已启动：

```bash
# 在项目根目录(demo)下运行
cd ..
python app.py
```

或者使用Docker启动：

```bash
# 在项目根目录(demo)下运行
cd ..
docker-compose up -d
```

### 2. 运行测试

#### 方法一：使用bash脚本（推荐）

```bash
# 在test目录下运行
./run_real_data_test.sh
```

#### 方法二：直接运行Python脚本

```bash
# 在test目录下运行
python test_real_data_api.py
```

### 3. 测试内容

测试脚本将执行以下操作：

1. **检查服务健康状态** - 确保服务正常运行
2. **获取示例文件** - 从`../raw_data/`目录中选择文件
3. **单文档处理测试** - 选择第一个文件进行处理
4. **批量文档处理测试** - 选择多个文件进行批量处理
5. **结果下载** - 下载处理结果并保存到`test_results/`目录
6. **结果预览** - 显示处理结果的内容预览

### 4. 测试结果目录结构

测试结果将保存在`test_results/`目录中，采用与主服务一致的目录结构：

```
test_results/
├── single_{filename}_result.json     # 单文档处理结果（旧格式，用于兼容性）
├── batch_results/                    # 批量处理结果目录
│   ├── batch_result_1.json
│   ├── batch_result_2.json
│   └── batch_result_3.json
└── {document_name}/                  # 新格式：每个文档独立目录
    └── result.json                   # 处理结果文件
```

这种目录结构与主服务中`merge_json_files.py`生成的结果保持一致：
- 每个处理的文档都有自己的目录
- 每个文档目录中包含一个统一命名为`result.json`的结果文件

## 注意事项

1. **服务依赖**：测试需要文档处理服务正在运行
2. **文件大小**：测试会自动选择较小的文件以加快测试速度
3. **网络连接**：确保可以访问`http://localhost:5000`
4. **权限**：确保有读取`../raw_data/`目录和写入当前目录的权限

## 故障排除

### 服务未运行
```
错误信息：无法连接到服务，请确保服务已启动
解决方法：启动文档处理服务
```

### 文件未找到
```
错误信息：未找到可用的示例文件
解决方法：确保../raw_data/目录中包含支持的文件格式
```

### 权限问题
```
错误信息：权限被拒绝
解决方法：检查目录权限，确保有读写权限
```

### 下载失败（404错误）
```
错误信息：下载失败: 404
解决方法：
1. 确保服务已正确处理文件
2. 检查文件路径是否正确编码
3. 重启服务后重新运行测试
```